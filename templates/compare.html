<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare - SEC Filing Parser & Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0d0d0d;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }

        header {
            background: #1a1a1a;
            padding: 20px 40px;
            border-bottom: 1px solid #2a2a2a;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        header h1 {
            color: #00c805;
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 500;
        }

        header ul {
            list-style-type: none;
            display: flex;
            gap: 15px;
        }

        header ul li a {
            color: #ffffff;
            text-decoration: none;
            font-size: 15px;
            padding: 10px 20px;
            background: #2a2a2a;
            border-radius: 24px;
            transition: all 0.3s ease;
            border: 1px solid #3a3a3a;
        }

        header ul li a:hover {
            background: #00c805;
            color: #0d0d0d;
            border-color: #00c805;
        }

        h2 {
            text-align: center;
            color: #d4d4d4;
            margin: 20px 0;
        }

        form {
            max-width: 400px;
            margin: 40px auto;
            padding: 40px;
            background: #1a1a1a;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid #2a2a2a;
        }

        select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 20px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #ffffff;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:focus {
            outline: none;
            border-color: #00c805;
            background: #333333;
        }

        select option {
            background: #2a2a2a;
            color: #ffffff;
        }

        input[type="submit"] {
            width: 100%;
            padding: 14px;
            background: #00c805;
            color: #0d0d0d;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        input[type="submit"]:hover {
            background: #00e006;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 200, 5, 0.3);
        }

        .results-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 40px;
            background: #1a1a1a;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid #2a2a2a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #2a2a2a;
            color: #00c805;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #00c805;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #2a2a2a;
            color: #d4d4d4;
        }

        tr:hover td {
            background: #2a2a2a;
        }

        .bold {
            font-weight: 600;
            color: #00c805;
        }

        .positive {
            color: #00c805;
        }

        .negative {
            color: #ff6b6b;
        }

        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
            }
            
            header ul {
                flex-direction: column;
            }
            
            form, .results-container {
                margin: 20px;
                padding: 25px;
            }

            table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>⚖️ Compare Companies</h1>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a href="/logout">Log Out</a></li>
        </ul>
        <div style="margin-top:12px; border-top:1px solid #2a2a2a; padding-top:10px;">
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
                {
                  "symbols": [
                    {"proName": "FOREXCOM:SPXUSD", "title": "S&P 500"},
                    {"proName": "NASDAQ:NDX", "title": "NASDAQ 100"},
                    {"proName": "NASDAQ:AAPL", "title": "Apple"},
                    {"proName": "NASDAQ:MSFT", "title": "Microsoft"},
                    {"proName": "NASDAQ:NVDA", "title": "NVIDIA"},
                    {"proName": "NASDAQ:AMZN", "title": "Amazon"},
                    {"proName": "NASDAQ:TSLA", "title": "Tesla"},
                    {"proName": "NASDAQ:GOOGL", "title": "Alphabet"}
                  ],
                  "showSymbolLogo": true,
                  "colorTheme": "dark",
                  "isTransparent": true,
                  "displayMode": "adaptive",
                  "locale": "en"
                }
                </script>
            </div>
        </div>
    </header>
    <form action="/compare" method="post">
        <select name="sectors" id="sectors" required>
            <option value="" disabled selected>Select a sector</option>
            <option value="Financial">Financial</option>
            <option value="Tech">Tech</option>
            <option value="Communication_services">Communication services</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Energy">Energy</option>
            <option value="Utilities">Utilities</option>
            <option value="Consumer_Cyclical">Consumer Cyclical</option>
            <option value="Industrials">Industrials</option>
            <option value="Real_Estate">Real Estate</option>
            <option value="Consumer_Defensive">Consumer Defensive</option>
            <option value="Basic_Materials">Basic Materials</option>
        </select>

        <select name="options" id="options" required>
            <option value="Revenue">Revenue</option>
            <option value="Operating Income">Operating Income</option>
            <option value="Net Income">Net Income</option>
            <option value="Earnings Per Share">Earnings per Share</option>
            <option value="Profit">Profit</option>
        </select>

        <input type="submit" value="Compare">
    </form>
    <div class="results-container">
        <h2>Results for <span class="bold">{{ sector }}</span> - <span class="bold">{{ option }}</span></h2>
        {% if results %}
        <table>
            <tr>
                <th>Company</th>
                <th>Value</th>
            </tr>
            {% for symbol, value in results %}
            <tr>
                <td class="bold">{{ symbol }}</td>
                <td>{{ value }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p style="text-align: center; color: #d4d4d4;">{{ message }}</p>
        {% endif %}
    </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var isInIframe = window.location !== window.parent.location;

    document.querySelectorAll('a[href="/"], a[href*="home"]').forEach(function(link) {
        link.addEventListener('click', function(event) {
            if (isInIframe) {
                event.preventDefault();
                window.parent.postMessage('navigateHome', '*');
            }
        });
    });
});
</script>
</body>
<style>
@keyframes scroll-left { 0% { transform: translateX(100%);} 100% { transform: translateX(-100%);} }
</style>
<script>
// Start with fallback data immediately, then update with real data
const el = document.getElementById('ticker-content');
const fallbackData = [
  {text: 'DOW: 37,500.00 (+0.25%)', change: 0.25},
  {text: 'S&P 500: 4,750.00 (+0.15%)', change: 0.15},
  {text: 'NASDAQ: 15,200.00 (+0.35%)', change: 0.35},
  {text: 'AAPL: $195.50 (+0.45%)', change: 0.45},
  {text: 'MSFT: $420.30 (+0.20%)', change: 0.20},
  {text: 'NVDA: $850.75 (+1.25%)', change: 1.25},
  {text: 'BTC: $65,000 (+2.10%)', change: 2.10},
  {text: 'ETH: $3,200 (+1.80%)', change: 1.80}
];

// Show fallback immediately
el.innerHTML = fallbackData.map(it => {
  const color = it.change >= 0 ? '#00c805' : '#ff6b6b';
  return `<span style="color:${color}">${it.text}</span>`;
}).join(' &nbsp; • &nbsp; ');

// Then fetch real data
fetch('/live_ticker').then(r=>r.json()).then(d=>{
  if(!d||!d.items||d.items.length===0) return; // Keep fallback if no real data
  el.innerHTML = d.items.map(it=>{
    const color = it.change>=0 ? '#00c805' : '#ff6b6b';
    return `<span style="color:${color}">${it.text}</span>`;
  }).join(' &nbsp; • &nbsp; ');
}).catch(()=>{}); // Silent fail, keep fallback
</script>
</html>
